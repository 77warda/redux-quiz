{"ast":null,"code":"import { createEffect, Actions, ofType } from '@ngrx/effects';\nimport { catchError, of, map, mergeMap, tap, switchMap, interval, takeUntil, EMPTY, take } from 'rxjs';\nimport { QuizActions } from './quiz-app.actions';\nimport { QuizApiActions } from './quiz-app.actions';\nimport { QuizReduxService } from '../quiz-redux.service';\nimport { Store } from '@ngrx/store';\nimport { selectTotalQuestions } from './quiz-app.selectors';\nimport { Router } from '@angular/router';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/effects\";\nimport * as i2 from \"../quiz-redux.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@ngrx/store\";\nexport class QuizAppEffects {\n  constructor(actions$, quizService, router, store) {\n    this.actions$ = actions$;\n    this.quizService = quizService;\n    this.router = router;\n    this.store = store;\n    this.startTimer$ = createEffect(() => this.actions$.pipe(ofType(QuizApiActions.loadQuestionsSuccess), switchMap(() => this.store.select(selectTotalQuestions)), tap(totalQuestions => {\n      let timerDuration = totalQuestions * 10;\n      this.store.dispatch(QuizActions.startTimer());\n      interval(1000).pipe(takeUntil(this.actions$.pipe(ofType(QuizActions.finishQuiz))), tap(() => {\n        timerDuration--;\n        if (timerDuration >= 0) {\n          const minutes = Math.floor(timerDuration / 60);\n          const seconds = timerDuration % 60;\n          const formattedMinutes = minutes < 10 ? '0' + minutes : '' + minutes;\n          const formattedSeconds = seconds < 10 ? '0' + seconds : '' + seconds;\n          this.store.dispatch(QuizActions.updateTimer({\n            uiTimer: `${formattedMinutes}:${formattedSeconds}`\n          }));\n          if (timerDuration === 0) {\n            this.store.dispatch(QuizActions.finishQuiz());\n          }\n        }\n      })).subscribe();\n    }), catchError(error => {\n      console.error('Error in startTimer effect:', error);\n      return EMPTY;\n    })), {\n      dispatch: false\n    });\n    // loadTrivia$ = createEffect(() =>\n    //   this.actions$.pipe(\n    //     ofType(QuizActions.submitForm),\n    //     mergeMap((action) =>\n    //       this.quizService.getTrivia(action.formValue).pipe(\n    //         tap(() => {\n    //           console.log('Form submitted successfully');\n    //           this.router.navigate(['/quizstart']);\n    //         }),\n    //         map((quizQuestions) =>\n    //           QuizApiActions.loadQuestionsSuccess({ quizQuestions })\n    //         ),\n    //         catchError((error) => {\n    //           console.error('Error in loadTrivia effect:', error);\n    //           return of(QuizApiActions.loadQuestionsFailure({ error }));\n    //         })\n    //       )\n    //     )\n    //   )\n    // );\n    this.loadTrivia$ = createEffect(() => this.actions$.pipe(ofType(QuizActions.submitForm), mergeMap(action => this.quizService.getTrivia(action.formValue).pipe(tap(() => {\n      console.log('Form submitted successfully');\n      this.router.navigate(['/quizstart']);\n    }), switchMap(quizQuestions => {\n      const totalQuestions = action.formValue.numberOfQuestions;\n      const timerDuration = totalQuestions * 10; // Assuming 10 seconds per question\n      // Log the timer start\n      console.log('Timer started');\n      interval(1000).pipe(take(timerDuration + 1),\n      // Take only up to the timer duration\n      tap(timeElapsed => {\n        const remainingTime = timerDuration - timeElapsed;\n        const minutes = Math.floor(remainingTime / 60);\n        const seconds = remainingTime % 60;\n        const formattedMinutes = minutes < 10 ? '0' + minutes : '' + minutes;\n        const formattedSeconds = seconds < 10 ? '0' + seconds : '' + seconds;\n        console.log('Time remaining:', `${formattedMinutes}:${formattedSeconds}`);\n        if (remainingTime === 0) {\n          this.store.dispatch(QuizActions.finishQuiz());\n        }\n      })).subscribe();\n      return [QuizApiActions.loadQuestionsSuccess({\n        quizQuestions\n      })];\n    }), catchError(error => {\n      console.error('Error in loadTrivia effect:', error);\n      return of(QuizApiActions.loadQuestionsFailure({\n        error\n      }));\n    })))));\n    this.loadCategories$ = createEffect(() => this.actions$.pipe(ofType(QuizActions.loadCategories), mergeMap(() => this.quizService.getCategories().pipe(map(categories => QuizApiActions.loadCategoriesSuccess({\n      categories\n    })), catchError(error => of(QuizApiActions.loadCategoriesFailure({\n      error\n    })))))));\n    this.finishQuiz$ = createEffect(() => this.actions$.pipe(ofType(QuizActions.finishQuiz), tap(() => {\n      this.router.navigate(['/result']);\n    })), {\n      dispatch: false\n    } // This effect does not dispatch any new actions\n    );\n  }\n  static #_ = this.ɵfac = function QuizAppEffects_Factory(t) {\n    return new (t || QuizAppEffects)(i0.ɵɵinject(i1.Actions), i0.ɵɵinject(i2.QuizReduxService), i0.ɵɵinject(i3.Router), i0.ɵɵinject(i4.Store));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: QuizAppEffects,\n    factory: QuizAppEffects.ɵfac\n  });\n}","map":{"version":3,"mappings":"AACA,SAASA,YAAY,EAAEC,OAAO,EAAEC,MAAM,QAAQ,eAAe;AAC7D,SACEC,UAAU,EACVC,EAAE,EACFC,GAAG,EACHC,QAAQ,EACRC,GAAG,EACHC,SAAS,EACTC,QAAQ,EACRC,SAAS,EACTC,KAAK,EACLC,IAAI,QACC,MAAM;AACb,SAASC,WAAW,QAAQ,oBAAoB;AAChD,SAASC,cAAc,QAAQ,oBAAoB;AACnD,SAASC,gBAAgB,QAAQ,uBAAuB;AACxD,SAASC,KAAK,QAAQ,aAAa;AACnC,SAASC,oBAAoB,QAAQ,sBAAsB;AAC3D,SAASC,MAAM,QAAQ,iBAAiB;;;;;;AAGxC,OAAM,MAAOC,cAAc;EACzBC,YACUC,QAAiB,EACjBC,WAA6B,EAC7BC,MAAc,EACdC,KAAY;IAHZ,aAAQ,GAARH,QAAQ;IACR,gBAAW,GAAXC,WAAW;IACX,WAAM,GAANC,MAAM;IACN,UAAK,GAALC,KAAK;IAGf,gBAAW,GAAGxB,YAAY,CACxB,MACE,IAAI,CAACqB,QAAQ,CAACI,IAAI,CAChBvB,MAAM,CAACY,cAAc,CAACY,oBAAoB,CAAC,EAC3ClB,SAAS,CAAC,MAAM,IAAI,CAACgB,KAAK,CAACG,MAAM,CAACV,oBAAoB,CAAC,CAAC,EACxDV,GAAG,CAAEqB,cAAmB,IAAI;MAC1B,IAAIC,aAAa,GAAGD,cAAc,GAAG,EAAE;MACvC,IAAI,CAACJ,KAAK,CAACM,QAAQ,CAACjB,WAAW,CAACkB,UAAU,EAAE,CAAC;MAC7CtB,QAAQ,CAAC,IAAI,CAAC,CACXgB,IAAI,CACHf,SAAS,CAAC,IAAI,CAACW,QAAQ,CAACI,IAAI,CAACvB,MAAM,CAACW,WAAW,CAACmB,UAAU,CAAC,CAAC,CAAC,EAC7DzB,GAAG,CAAC,MAAK;QACPsB,aAAa,EAAE;QACf,IAAIA,aAAa,IAAI,CAAC,EAAE;UACtB,MAAMI,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACN,aAAa,GAAG,EAAE,CAAC;UAC9C,MAAMO,OAAO,GAAGP,aAAa,GAAG,EAAE;UAClC,MAAMQ,gBAAgB,GACpBJ,OAAO,GAAG,EAAE,GAAG,GAAG,GAAGA,OAAO,GAAG,EAAE,GAAGA,OAAO;UAC7C,MAAMK,gBAAgB,GACpBF,OAAO,GAAG,EAAE,GAAG,GAAG,GAAGA,OAAO,GAAG,EAAE,GAAGA,OAAO;UAC7C,IAAI,CAACZ,KAAK,CAACM,QAAQ,CACjBjB,WAAW,CAAC0B,WAAW,CAAC;YACtBC,OAAO,EAAE,GAAGH,gBAAgB,IAAIC,gBAAgB;WACjD,CAAC,CACH;UACD,IAAIT,aAAa,KAAK,CAAC,EAAE;YACvB,IAAI,CAACL,KAAK,CAACM,QAAQ,CAACjB,WAAW,CAACmB,UAAU,EAAE,CAAC;;;MAGnD,CAAC,CAAC,CACH,CACAS,SAAS,EAAE;IAChB,CAAC,CAAC,EACFtC,UAAU,CAAEuC,KAAK,IAAI;MACnBC,OAAO,CAACD,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;MACnD,OAAO/B,KAAK;IACd,CAAC,CAAC,CACH,EACH;MAAEmB,QAAQ,EAAE;IAAK,CAAE,CACpB;IAED;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA,gBAAW,GAAG9B,YAAY,CAAC,MACzB,IAAI,CAACqB,QAAQ,CAACI,IAAI,CAChBvB,MAAM,CAACW,WAAW,CAAC+B,UAAU,CAAC,EAC9BtC,QAAQ,CAAEuC,MAAM,IACd,IAAI,CAACvB,WAAW,CAACwB,SAAS,CAACD,MAAM,CAACE,SAAS,CAAC,CAACtB,IAAI,CAC/ClB,GAAG,CAAC,MAAK;MACPoC,OAAO,CAACK,GAAG,CAAC,6BAA6B,CAAC;MAC1C,IAAI,CAACzB,MAAM,CAAC0B,QAAQ,CAAC,CAAC,YAAY,CAAC,CAAC;IACtC,CAAC,CAAC,EACFzC,SAAS,CAAE0C,aAAa,IAAI;MAC1B,MAAMtB,cAAc,GAAGiB,MAAM,CAACE,SAAS,CAACI,iBAAiB;MACzD,MAAMtB,aAAa,GAAGD,cAAc,GAAG,EAAE,CAAC,CAAC;MAE3C;MACAe,OAAO,CAACK,GAAG,CAAC,eAAe,CAAC;MAC5BvC,QAAQ,CAAC,IAAI,CAAC,CACXgB,IAAI,CACHb,IAAI,CAACiB,aAAa,GAAG,CAAC,CAAC;MAAE;MACzBtB,GAAG,CAAE6C,WAAW,IAAI;QAClB,MAAMC,aAAa,GAAGxB,aAAa,GAAGuB,WAAW;QACjD,MAAMnB,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACkB,aAAa,GAAG,EAAE,CAAC;QAC9C,MAAMjB,OAAO,GAAGiB,aAAa,GAAG,EAAE;QAClC,MAAMhB,gBAAgB,GACpBJ,OAAO,GAAG,EAAE,GAAG,GAAG,GAAGA,OAAO,GAAG,EAAE,GAAGA,OAAO;QAC7C,MAAMK,gBAAgB,GACpBF,OAAO,GAAG,EAAE,GAAG,GAAG,GAAGA,OAAO,GAAG,EAAE,GAAGA,OAAO;QAC7CO,OAAO,CAACK,GAAG,CACT,iBAAiB,EACjB,GAAGX,gBAAgB,IAAIC,gBAAgB,EAAE,CAC1C;QAED,IAAIe,aAAa,KAAK,CAAC,EAAE;UACvB,IAAI,CAAC7B,KAAK,CAACM,QAAQ,CAACjB,WAAW,CAACmB,UAAU,EAAE,CAAC;;MAEjD,CAAC,CAAC,CACH,CACAS,SAAS,EAAE;MAEd,OAAO,CAAC3B,cAAc,CAACY,oBAAoB,CAAC;QAAEwB;MAAa,CAAE,CAAC,CAAC;IACjE,CAAC,CAAC,EACF/C,UAAU,CAAEuC,KAAK,IAAI;MACnBC,OAAO,CAACD,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;MACnD,OAAOtC,EAAE,CAACU,cAAc,CAACwC,oBAAoB,CAAC;QAAEZ;MAAK,CAAE,CAAC,CAAC;IAC3D,CAAC,CAAC,CACH,CACF,CACF,CACF;IAED,oBAAe,GAAG1C,YAAY,CAAC,MAC7B,IAAI,CAACqB,QAAQ,CAACI,IAAI,CAChBvB,MAAM,CAACW,WAAW,CAAC0C,cAAc,CAAC,EAClCjD,QAAQ,CAAC,MACP,IAAI,CAACgB,WAAW,CAACkC,aAAa,EAAE,CAAC/B,IAAI,CACnCpB,GAAG,CAAEoD,UAAU,IACb3C,cAAc,CAAC4C,qBAAqB,CAAC;MAAED;IAAU,CAAE,CAAC,CACrD,EACDtD,UAAU,CAAEuC,KAAK,IACftC,EAAE,CAACU,cAAc,CAAC6C,qBAAqB,CAAC;MAAEjB;IAAK,CAAE,CAAC,CAAC,CACpD,CACF,CACF,CACF,CACF;IACD,gBAAW,GAAG1C,YAAY,CACxB,MACE,IAAI,CAACqB,QAAQ,CAACI,IAAI,CAChBvB,MAAM,CAACW,WAAW,CAACmB,UAAU,CAAC,EAC9BzB,GAAG,CAAC,MAAK;MACP,IAAI,CAACgB,MAAM,CAAC0B,QAAQ,CAAC,CAAC,SAAS,CAAC,CAAC;IACnC,CAAC,CAAC,CACH,EACH;MAAEnB,QAAQ,EAAE;IAAK,CAAE,CAAC;IAAA,CACrB;EAxIE;EAAC;qBANOX,cAAc;EAAA;EAAA;WAAdA,cAAc;IAAAyC,SAAdzC,cAAc;EAAA","names":["createEffect","Actions","ofType","catchError","of","map","mergeMap","tap","switchMap","interval","takeUntil","EMPTY","take","QuizActions","QuizApiActions","QuizReduxService","Store","selectTotalQuestions","Router","QuizAppEffects","constructor","actions$","quizService","router","store","pipe","loadQuestionsSuccess","select","totalQuestions","timerDuration","dispatch","startTimer","finishQuiz","minutes","Math","floor","seconds","formattedMinutes","formattedSeconds","updateTimer","uiTimer","subscribe","error","console","submitForm","action","getTrivia","formValue","log","navigate","quizQuestions","numberOfQuestions","timeElapsed","remainingTime","loadQuestionsFailure","loadCategories","getCategories","categories","loadCategoriesSuccess","loadCategoriesFailure","factory"],"sourceRoot":"","sources":["/Users/macbookpro/OneSchool/rxjs/redux-quiz/apps/quiz-redux-app/src/app/+state/quiz-app.effects.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { createEffect, Actions, ofType } from '@ngrx/effects';\nimport {\n  catchError,\n  of,\n  map,\n  mergeMap,\n  tap,\n  switchMap,\n  interval,\n  takeUntil,\n  EMPTY,\n  take,\n} from 'rxjs';\nimport { QuizActions } from './quiz-app.actions';\nimport { QuizApiActions } from './quiz-app.actions';\nimport { QuizReduxService } from '../quiz-redux.service';\nimport { Store } from '@ngrx/store';\nimport { selectTotalQuestions } from './quiz-app.selectors';\nimport { Router } from '@angular/router';\n\n@Injectable()\nexport class QuizAppEffects {\n  constructor(\n    private actions$: Actions,\n    private quizService: QuizReduxService,\n    private router: Router,\n    private store: Store\n  ) {}\n\n  startTimer$ = createEffect(\n    () =>\n      this.actions$.pipe(\n        ofType(QuizApiActions.loadQuestionsSuccess),\n        switchMap(() => this.store.select(selectTotalQuestions)),\n        tap((totalQuestions: any) => {\n          let timerDuration = totalQuestions * 10;\n          this.store.dispatch(QuizActions.startTimer());\n          interval(1000)\n            .pipe(\n              takeUntil(this.actions$.pipe(ofType(QuizActions.finishQuiz))),\n              tap(() => {\n                timerDuration--;\n                if (timerDuration >= 0) {\n                  const minutes = Math.floor(timerDuration / 60);\n                  const seconds = timerDuration % 60;\n                  const formattedMinutes =\n                    minutes < 10 ? '0' + minutes : '' + minutes;\n                  const formattedSeconds =\n                    seconds < 10 ? '0' + seconds : '' + seconds;\n                  this.store.dispatch(\n                    QuizActions.updateTimer({\n                      uiTimer: `${formattedMinutes}:${formattedSeconds}`,\n                    })\n                  );\n                  if (timerDuration === 0) {\n                    this.store.dispatch(QuizActions.finishQuiz());\n                  }\n                }\n              })\n            )\n            .subscribe();\n        }),\n        catchError((error) => {\n          console.error('Error in startTimer effect:', error);\n          return EMPTY;\n        })\n      ),\n    { dispatch: false }\n  );\n\n  // loadTrivia$ = createEffect(() =>\n  //   this.actions$.pipe(\n  //     ofType(QuizActions.submitForm),\n  //     mergeMap((action) =>\n  //       this.quizService.getTrivia(action.formValue).pipe(\n  //         tap(() => {\n  //           console.log('Form submitted successfully');\n  //           this.router.navigate(['/quizstart']);\n  //         }),\n  //         map((quizQuestions) =>\n  //           QuizApiActions.loadQuestionsSuccess({ quizQuestions })\n  //         ),\n  //         catchError((error) => {\n  //           console.error('Error in loadTrivia effect:', error);\n  //           return of(QuizApiActions.loadQuestionsFailure({ error }));\n  //         })\n  //       )\n  //     )\n  //   )\n  // );\n  loadTrivia$ = createEffect(() =>\n    this.actions$.pipe(\n      ofType(QuizActions.submitForm),\n      mergeMap((action) =>\n        this.quizService.getTrivia(action.formValue).pipe(\n          tap(() => {\n            console.log('Form submitted successfully');\n            this.router.navigate(['/quizstart']);\n          }),\n          switchMap((quizQuestions) => {\n            const totalQuestions = action.formValue.numberOfQuestions;\n            const timerDuration = totalQuestions * 10; // Assuming 10 seconds per question\n\n            // Log the timer start\n            console.log('Timer started');\n            interval(1000)\n              .pipe(\n                take(timerDuration + 1), // Take only up to the timer duration\n                tap((timeElapsed) => {\n                  const remainingTime = timerDuration - timeElapsed;\n                  const minutes = Math.floor(remainingTime / 60);\n                  const seconds = remainingTime % 60;\n                  const formattedMinutes =\n                    minutes < 10 ? '0' + minutes : '' + minutes;\n                  const formattedSeconds =\n                    seconds < 10 ? '0' + seconds : '' + seconds;\n                  console.log(\n                    'Time remaining:',\n                    `${formattedMinutes}:${formattedSeconds}`\n                  );\n\n                  if (remainingTime === 0) {\n                    this.store.dispatch(QuizActions.finishQuiz());\n                  }\n                })\n              )\n              .subscribe();\n\n            return [QuizApiActions.loadQuestionsSuccess({ quizQuestions })];\n          }),\n          catchError((error) => {\n            console.error('Error in loadTrivia effect:', error);\n            return of(QuizApiActions.loadQuestionsFailure({ error }));\n          })\n        )\n      )\n    )\n  );\n\n  loadCategories$ = createEffect(() =>\n    this.actions$.pipe(\n      ofType(QuizActions.loadCategories),\n      mergeMap(() =>\n        this.quizService.getCategories().pipe(\n          map((categories) =>\n            QuizApiActions.loadCategoriesSuccess({ categories })\n          ),\n          catchError((error) =>\n            of(QuizApiActions.loadCategoriesFailure({ error }))\n          )\n        )\n      )\n    )\n  );\n  finishQuiz$ = createEffect(\n    () =>\n      this.actions$.pipe(\n        ofType(QuizActions.finishQuiz),\n        tap(() => {\n          this.router.navigate(['/result']);\n        })\n      ),\n    { dispatch: false } // This effect does not dispatch any new actions\n  );\n  // startTimer(duration: number): void {\n  //   setTimeout(() => {\n  //     let timer = duration;\n\n  //     this.store.dispatch(QuizActions.startTimer());\n\n  //     this.store\n  //       .pipe(\n  //         ofType(QuizActions.startTimer),\n  //         switchMap(() => interval(1000)),\n  //         tap(() => {\n  //           if (timer >= 0) {\n  //             const minutes = Math.floor(timer / 60);\n  //             const seconds = timer % 60;\n\n  //             const formattedMinutes =\n  //               minutes < 10 ? '0' + minutes : '' + minutes;\n  //             const formattedSeconds =\n  //               seconds < 10 ? '0' + seconds : '' + seconds;\n\n  //             this.store.dispatch(\n  //               QuizActions.updateTimer({\n  //                 uiTimer: `${formattedMinutes}:${formattedSeconds}`,\n  //               })\n  //             );\n\n  //             if (timer === 0) {\n  //               this.store.dispatch(QuizActions.finishQuiz());\n  //             }\n  //             timer--;\n  //           }\n  //         })\n  //       )\n  //       .subscribe();\n  //   }, 500);\n  // }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}