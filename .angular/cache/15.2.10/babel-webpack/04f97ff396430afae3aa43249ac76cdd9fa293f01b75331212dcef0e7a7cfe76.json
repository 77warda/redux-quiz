{"ast":null,"code":"import { createEffect, Actions, ofType } from '@ngrx/effects';\nimport { switchMap, catchError, of, map, tap } from 'rxjs';\nimport * as QuizAppActions from './quiz-app.actions';\nimport { QuizReduxService } from '../quiz-redux.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/effects\";\nimport * as i2 from \"../quiz-redux.service\";\nexport class QuizAppEffects {\n  constructor(actions$, triviaService // Inject your trivia service\n  ) {\n    this.actions$ = actions$;\n    this.triviaService = triviaService;\n    this.loadQuestions$ = createEffect(() => this.actions$.pipe(ofType(QuizAppActions.loadQuestions), tap(() => console.log('Fetching trivia questions...')), switchMap(() => this.triviaService.getTriviaQuestion().pipe(map(triviaResponse => {\n      console.log('Trivia questions received from Effects:', triviaResponse);\n      if (triviaResponse) {\n        const questions = triviaResponse.map(questionItem => ({\n          question: questionItem.question.text,\n          options: this.shuffleArray([...questionItem.incorrectAnswers, questionItem.correctAnswer]),\n          correctAnswer: questionItem.correctAnswer\n        }));\n        // Dispatch the loadQuestionsSuccess action with the correct payload\n        return QuizAppActions.loadQuestionsSuccess({\n          questions\n        });\n      } else {\n        console.error('Invalid response structure');\n        return QuizAppActions.loadQuestionsFailure({\n          error: 'Invalid response structure'\n        });\n      }\n    }), catchError(error => of(QuizAppActions.loadQuestionsFailure({\n      error\n    })))))));\n  }\n  shuffleArray(array) {\n    return array.sort(() => Math.random() - 0.6);\n  }\n  static #_ = this.ɵfac = function QuizAppEffects_Factory(t) {\n    return new (t || QuizAppEffects)(i0.ɵɵinject(i1.Actions), i0.ɵɵinject(i2.QuizReduxService));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: QuizAppEffects,\n    factory: QuizAppEffects.ɵfac\n  });\n}","map":{"version":3,"mappings":"AACA,SAASA,YAAY,EAAEC,OAAO,EAAEC,MAAM,QAAQ,eAAe;AAC7D,SAASC,SAAS,EAAEC,UAAU,EAAEC,EAAE,EAAEC,GAAG,EAAYC,GAAG,QAAQ,MAAM;AACpE,OAAO,KAAKC,cAAc,MAAM,oBAAoB;AAEpD,SAASC,gBAAgB,QAAQ,uBAAuB;;;;AAIxD,OAAM,MAAOC,cAAc;EACzBC,YACUC,QAAiB,EACjBC,aAA+B,CAAC;EAAA;IADhC,aAAQ,GAARD,QAAQ;IACR,kBAAa,GAAbC,aAAa;IAGvB,mBAAc,GAAGb,YAAY,CAAC,MAC5B,IAAI,CAACY,QAAQ,CAACE,IAAI,CAChBZ,MAAM,CAACM,cAAc,CAACO,aAAa,CAAC,EACpCR,GAAG,CAAC,MAAMS,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAC,CAAC,EACtDd,SAAS,CAAC,MACR,IAAI,CAACU,aAAa,CAACK,iBAAiB,EAAE,CAACJ,IAAI,CACzCR,GAAG,CAAEa,cAAmB,IAAI;MAC1BH,OAAO,CAACC,GAAG,CACT,yCAAyC,EACzCE,cAAc,CACf;MAED,IAAIA,cAAc,EAAE;QAClB,MAAMC,SAAS,GAAeD,cAAc,CAACb,GAAG,CAC7Ce,YAAiB,KAAM;UACtBC,QAAQ,EAAED,YAAY,CAACC,QAAQ,CAACC,IAAI;UACpCC,OAAO,EAAE,IAAI,CAACC,YAAY,CAAC,CACzB,GAAGJ,YAAY,CAACK,gBAAgB,EAChCL,YAAY,CAACM,aAAa,CAC3B,CAAC;UACFA,aAAa,EAAEN,YAAY,CAACM;SAC7B,CAAC,CACH;QAED;QACA,OAAOnB,cAAc,CAACoB,oBAAoB,CAAC;UAAER;QAAS,CAAE,CAAC;OAC1D,MAAM;QACLJ,OAAO,CAACa,KAAK,CAAC,4BAA4B,CAAC;QAC3C,OAAOrB,cAAc,CAACsB,oBAAoB,CAAC;UACzCD,KAAK,EAAE;SACR,CAAC;;IAEN,CAAC,CAAC,EACFzB,UAAU,CAAEyB,KAAK,IACfxB,EAAE,CAACG,cAAc,CAACsB,oBAAoB,CAAC;MAAED;IAAK,CAAE,CAAC,CAAC,CACnD,CACF,CACF,CACF,CACF;EAzCE;EA2CHJ,YAAY,CAACM,KAAe;IAC1B,OAAOA,KAAK,CAACC,IAAI,CAAC,MAAMC,IAAI,CAACC,MAAM,EAAE,GAAG,GAAG,CAAC;EAC9C;EAAC;qBAjDUxB,cAAc;EAAA;EAAA;WAAdA,cAAc;IAAAyB,SAAdzB,cAAc;EAAA","names":["createEffect","Actions","ofType","switchMap","catchError","of","map","tap","QuizAppActions","QuizReduxService","QuizAppEffects","constructor","actions$","triviaService","pipe","loadQuestions","console","log","getTriviaQuestion","triviaResponse","questions","questionItem","question","text","options","shuffleArray","incorrectAnswers","correctAnswer","loadQuestionsSuccess","error","loadQuestionsFailure","array","sort","Math","random","factory"],"sourceRoot":"","sources":["/Users/macbookpro/OneSchool/rxjs/redux-quiz/apps/quiz-redux-app/src/app/+state/quiz-app.effects.ts"],"sourcesContent":["import { Injectable, inject } from '@angular/core';\nimport { createEffect, Actions, ofType } from '@ngrx/effects';\nimport { switchMap, catchError, of, map, mergeMap, tap } from 'rxjs';\nimport * as QuizAppActions from './quiz-app.actions';\nimport * as QuizAppFeature from './quiz-app.reducer';\nimport { QuizReduxService } from '../quiz-redux.service';\nimport { Question } from '../quiz/quiz.interface';\n\n@Injectable()\nexport class QuizAppEffects {\n  constructor(\n    private actions$: Actions,\n    private triviaService: QuizReduxService // Inject your trivia service\n  ) {}\n\n  loadQuestions$ = createEffect(() =>\n    this.actions$.pipe(\n      ofType(QuizAppActions.loadQuestions),\n      tap(() => console.log('Fetching trivia questions...')),\n      switchMap(() =>\n        this.triviaService.getTriviaQuestion().pipe(\n          map((triviaResponse: any) => {\n            console.log(\n              'Trivia questions received from Effects:',\n              triviaResponse\n            );\n\n            if (triviaResponse) {\n              const questions: Question[] = triviaResponse.map(\n                (questionItem: any) => ({\n                  question: questionItem.question.text,\n                  options: this.shuffleArray([\n                    ...questionItem.incorrectAnswers,\n                    questionItem.correctAnswer,\n                  ]),\n                  correctAnswer: questionItem.correctAnswer,\n                })\n              );\n\n              // Dispatch the loadQuestionsSuccess action with the correct payload\n              return QuizAppActions.loadQuestionsSuccess({ questions });\n            } else {\n              console.error('Invalid response structure');\n              return QuizAppActions.loadQuestionsFailure({\n                error: 'Invalid response structure',\n              });\n            }\n          }),\n          catchError((error) =>\n            of(QuizAppActions.loadQuestionsFailure({ error }))\n          )\n        )\n      )\n    )\n  );\n\n  shuffleArray(array: string[]): string[] {\n    return array.sort(() => Math.random() - 0.6);\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}