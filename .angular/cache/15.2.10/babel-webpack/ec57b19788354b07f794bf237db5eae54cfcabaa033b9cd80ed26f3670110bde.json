{"ast":null,"code":"import { createEffect, Actions, ofType } from '@ngrx/effects';\nimport { catchError, of, map, mergeMap, tap } from 'rxjs';\nimport { QuizActions } from './quiz-app.actions';\nimport { QuizReduxService } from '../quiz-redux.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/effects\";\nimport * as i2 from \"../quiz-redux.service\";\nexport class QuizAppEffects {\n  constructor(actions$, triviaService // Inject your trivia service\n  ) {\n    this.actions$ = actions$;\n    this.triviaService = triviaService;\n    // loadQuestions$ = createEffect(() =>\n    //   this.actions$.pipe(\n    //     ofType(QuizActions.loadQuestions),\n    //     // tap(() => console.log('Fetching trivia questions...')),\n    //     switchMap(() =>\n    //       this.triviaService.getTriviaQuestion().pipe(\n    //         map((triviaResponse: any) => {\n    //           console.log(\n    //             'Trivia questions received from Effects:',\n    //             triviaResponse\n    //           );\n    //           if (triviaResponse) {\n    // const questions: Question[] = triviaResponse.map(\n    //   (questionItem: any) => ({\n    //     question: questionItem.question.text,\n    //     options: this.shuffleArray([\n    //       ...questionItem.incorrectAnswers,\n    //       questionItem.correctAnswer,\n    //     ]),\n    //     correctAnswer: questionItem.correctAnswer,\n    //   })\n    // );\n    //             // Dispatch the loadQuestionsSuccess action with the correct payload\n    //             return QuizActions.loadQuestionsSuccess({ questions });\n    //           } else {\n    //             console.error('Invalid response structure');\n    //             return QuizActions.loadQuestionsFailure({\n    //               error: 'Invalid response structure',\n    //             });\n    //           }\n    //         }),\n    //         catchError((error) => of(QuizActions.loadQuestionsFailure({ error })))\n    //       )\n    //     )\n    //   )\n    // );\n    // shuffleArray(array: string[]): string[] {\n    //   return array.sort(() => Math.random() - 0.6);\n    // }\n    this.loadTrivia$ = createEffect(() => this.actions$.pipe(ofType(QuizActions.loadQuestionsSuccess), tap(() => console.log('Fetching trivia questions...')), mergeMap(() => this.triviaService.getTriviaQuestion().pipe(map(triviaResponse => {\n      const questions = triviaResponse.map(questionItem => ({\n        question: questionItem.question.text,\n        options: [...questionItem.incorrectAnswers, questionItem.correctAnswer],\n        correctAnswer: questionItem.correctAnswer\n      }));\n      return QuizActions.loadQuestionsSuccess({\n        questions\n      });\n    }), catchError(error => {\n      console.error('Error in loadTodos effect:', error);\n      return of(QuizActions.loadQuestionsFailure({\n        error\n      }));\n    })))));\n  }\n  static #_ = this.ɵfac = function QuizAppEffects_Factory(t) {\n    return new (t || QuizAppEffects)(i0.ɵɵinject(i1.Actions), i0.ɵɵinject(i2.QuizReduxService));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: QuizAppEffects,\n    factory: QuizAppEffects.ɵfac\n  });\n}","map":{"version":3,"mappings":"AACA,SAASA,YAAY,EAAEC,OAAO,EAAEC,MAAM,QAAQ,eAAe;AAC7D,SAAoBC,UAAU,EAAEC,EAAE,EAAEC,GAAG,EAAEC,QAAQ,EAAEC,GAAG,QAAQ,MAAM;AACpE,SAASC,WAAW,QAAQ,oBAAoB;AAEhD,SAASC,gBAAgB,QAAQ,uBAAuB;;;;AAIxD,OAAM,MAAOC,cAAc;EACzBC,YACUC,QAAiB,EACjBC,aAA+B,CAAC;EAAA;IADhC,aAAQ,GAARD,QAAQ;IACR,kBAAa,GAAbC,aAAa;IAGvB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA;IACA;IACA;IACA,gBAAW,GAAGb,YAAY,CAAC,MACzB,IAAI,CAACY,QAAQ,CAACE,IAAI,CAChBZ,MAAM,CAACM,WAAW,CAACO,oBAAoB,CAAC,EACxCR,GAAG,CAAC,MAAMS,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAC,CAAC,EACtDX,QAAQ,CAAC,MACP,IAAI,CAACO,aAAa,CAACK,iBAAiB,EAAE,CAACJ,IAAI,CACzCT,GAAG,CAAEc,cAAmB,IAAI;MAC1B,MAAMC,SAAS,GAAeD,cAAc,CAACd,GAAG,CAC7CgB,YAAiB,KAAM;QACtBC,QAAQ,EAAED,YAAY,CAACC,QAAQ,CAACC,IAAI;QACpCC,OAAO,EAAE,CACP,GAAGH,YAAY,CAACI,gBAAgB,EAChCJ,YAAY,CAACK,aAAa,CAC3B;QACDA,aAAa,EAAEL,YAAY,CAACK;OAC7B,CAAC,CACH;MACD,OAAOlB,WAAW,CAACO,oBAAoB,CAAC;QAAEK;MAAS,CAAE,CAAC;IACxD,CAAC,CAAC,EACFjB,UAAU,CAAEwB,KAAK,IAAI;MACnBX,OAAO,CAACW,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;MAClD,OAAOvB,EAAE,CAACI,WAAW,CAACoB,oBAAoB,CAAC;QAAED;MAAK,CAAE,CAAC,CAAC;IACxD,CAAC,CAAC,CACH,CACF,CACF,CACF;EAtEE;EAAC;qBAJOjB,cAAc;EAAA;EAAA;WAAdA,cAAc;IAAAmB,SAAdnB,cAAc;EAAA","names":["createEffect","Actions","ofType","catchError","of","map","mergeMap","tap","QuizActions","QuizReduxService","QuizAppEffects","constructor","actions$","triviaService","pipe","loadQuestionsSuccess","console","log","getTriviaQuestion","triviaResponse","questions","questionItem","question","text","options","incorrectAnswers","correctAnswer","error","loadQuestionsFailure","factory"],"sourceRoot":"","sources":["/Users/macbookpro/OneSchool/rxjs/redux-quiz/apps/quiz-redux-app/src/app/+state/quiz-app.effects.ts"],"sourcesContent":["import { Injectable, inject } from '@angular/core';\nimport { createEffect, Actions, ofType } from '@ngrx/effects';\nimport { switchMap, catchError, of, map, mergeMap, tap } from 'rxjs';\nimport { QuizActions } from './quiz-app.actions';\nimport * as QuizAppFeature from './quiz-app.reducer';\nimport { QuizReduxService } from '../quiz-redux.service';\nimport { Question } from '../quiz/quiz.interface';\n\n@Injectable()\nexport class QuizAppEffects {\n  constructor(\n    private actions$: Actions,\n    private triviaService: QuizReduxService // Inject your trivia service\n  ) {}\n\n  // loadQuestions$ = createEffect(() =>\n  //   this.actions$.pipe(\n  //     ofType(QuizActions.loadQuestions),\n  //     // tap(() => console.log('Fetching trivia questions...')),\n  //     switchMap(() =>\n  //       this.triviaService.getTriviaQuestion().pipe(\n  //         map((triviaResponse: any) => {\n  //           console.log(\n  //             'Trivia questions received from Effects:',\n  //             triviaResponse\n  //           );\n\n  //           if (triviaResponse) {\n  // const questions: Question[] = triviaResponse.map(\n  //   (questionItem: any) => ({\n  //     question: questionItem.question.text,\n  //     options: this.shuffleArray([\n  //       ...questionItem.incorrectAnswers,\n  //       questionItem.correctAnswer,\n  //     ]),\n  //     correctAnswer: questionItem.correctAnswer,\n  //   })\n  // );\n\n  //             // Dispatch the loadQuestionsSuccess action with the correct payload\n  //             return QuizActions.loadQuestionsSuccess({ questions });\n  //           } else {\n  //             console.error('Invalid response structure');\n  //             return QuizActions.loadQuestionsFailure({\n  //               error: 'Invalid response structure',\n  //             });\n  //           }\n  //         }),\n  //         catchError((error) => of(QuizActions.loadQuestionsFailure({ error })))\n  //       )\n  //     )\n  //   )\n  // );\n\n  // shuffleArray(array: string[]): string[] {\n  //   return array.sort(() => Math.random() - 0.6);\n  // }\n  loadTrivia$ = createEffect(() =>\n    this.actions$.pipe(\n      ofType(QuizActions.loadQuestionsSuccess),\n      tap(() => console.log('Fetching trivia questions...')),\n      mergeMap(() =>\n        this.triviaService.getTriviaQuestion().pipe(\n          map((triviaResponse: any) => {\n            const questions: Question[] = triviaResponse.map(\n              (questionItem: any) => ({\n                question: questionItem.question.text,\n                options: [\n                  ...questionItem.incorrectAnswers,\n                  questionItem.correctAnswer,\n                ],\n                correctAnswer: questionItem.correctAnswer,\n              })\n            );\n            return QuizActions.loadQuestionsSuccess({ questions });\n          }),\n          catchError((error) => {\n            console.error('Error in loadTodos effect:', error);\n            return of(QuizActions.loadQuestionsFailure({ error }));\n          })\n        )\n      )\n    )\n  );\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}